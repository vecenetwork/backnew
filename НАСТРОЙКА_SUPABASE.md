# Настройка проекта VECE с Supabase

Краткое описание того, что было сделано и как этим пользоваться.

---

## 1. Файл .env (подключение к базе)

**Что сделано:** Создан файл `.env` в папке `vecenetwork-project-main` с параметрами Supabase.

**Простыми словами:** В этом файле хранятся адрес базы, логин и пароль. Приложение читает их при запуске и подключается к Supabase.

---

## 2. Connection Pooler (способ подключения)

**Что сделано:** Используется Connection Pooler Supabase (порт 6543) вместо прямого подключения.

**Простыми словами:** Supabase предлагает два способа подключения. Прямое (порт 5432) у вас не работало. Pooler (порт 6543) — это «прокси» перед базой, через него подключение проходит стабильно.

---

## 3. Миграции (создание таблиц)

**Что сделано:** Написан скрипт `scripts/run_migrations.py`, который выполняет все SQL-миграции и создаёт таблицы в Supabase.

**Простыми словами:** Миграции — это пошаговые инструкции для базы: создать таблицы, добавить колонки, вставить справочники (страны, хештеги). Скрипт выполняет их по очереди.

**Запуск:**
```bash
cd vecenetwork-project-main
backend/.venv/bin/python scripts/run_migrations.py
```

---

## 4. Таблицы в базе

**Что создано:**
- `countries` — справочник стран (246 записей)
- `barrier_tokens` — пригласительные коды для регистрации
- `users` — пользователи
- `user_settings` — настройки пользователей
- `hashtags` — хештеги (много предзаполненных)
- `subscriptions` — подписки на пользователей и хештеги
- `questions` — вопросы/опросы
- `question_options` — варианты ответов
- `answers` — ответы пользователей
- `waitlist` — лист ожидания

---

## 5. Проверка подключения

**Что сделано:** Скрипт `scripts/check_db_connection.py` проверяет, что приложение может подключиться к Supabase.

**Запуск:**
```bash
cd vecenetwork-project-main
backend/.venv/bin/python scripts/check_db_connection.py
```

При успехе выводится: `Подключение успешно!`

---

## 6. Запуск приложения

**Что сделано:** Добавлена загрузка `.env` при старте приложения (через `python-dotenv`).

**Запуск:**
```bash
cd vecenetwork-project-main/backend
uv run uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

Или, если установлен `uv`:
```bash
cd vecenetwork-project-main
uv run --project backend uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

После запуска:
- API: http://localhost:8000/api
- Документация: http://localhost:8000/api/docs

---

## 7. Краткая последовательность действий

1. Создать проект в Supabase и получить строку подключения.
2. Создать `.env` и указать в нём параметры Supabase.
3. Запустить миграции: `backend/.venv/bin/python scripts/run_migrations.py`
4. Запустить приложение: `uv run uvicorn main:app ...` (из папки backend).

---

## Важно

- `.env` содержит пароль — не публикуйте его в репозитории (он уже в `.gitignore`).
- На бесплатном тарифе Supabase проект может приостанавливаться при простое — его нужно восстанавливать вручную.
- Для миграций используется порт 5432 (session mode), для приложения — 6543 (transaction mode).
